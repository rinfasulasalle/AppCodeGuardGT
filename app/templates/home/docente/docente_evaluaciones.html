{% extends "layouts/base.html" %}

{% block title %}Evaluaciones de Docente{% endblock %} 

{% block stylesheets %}
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <link rel="stylesheet" href="/static/assets/plugins/fontawesome-free/css/all.min.css">
  <link rel="stylesheet" href="/static/assets/css/adminlte.min.css">
  <style>
    .curso-card { margin-bottom: 1.5rem; border-radius: 8px; }
    .evaluacion-item { padding: 10px; border-radius: 6px; background-color: #f8f9fa; margin-bottom: 10px; }
    .evaluacion-item strong { color: #007bff; }
  </style>
{% endblock stylesheets %}

{% block content %}  
  <div class="content-wrapper">
    <section class="content-header">
      <div class="container-fluid">
        <h1>Evaluaciones del Docente</h1>
      </div>
    </section>
    <section class="content">
      <div class="container-fluid">
        <div id="evaluaciones-list" class="row"></div>
      </div>
    </section>
  </div>
{% endblock content %}

{% block javascripts %}
  <script src="/static/assets/plugins/jquery/jquery.min.js"></script>
  <script src="/static/assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/static/assets/js/adminlte.min.js"></script>

  <script>
    const evaluacionesList = document.getElementById('evaluaciones-list');
    const dni_docente = "{{ current_user.dni }}";
    const url = "{{ url_for('evaluacion.get_evaluaciones_by_docente', dni_docente='') }}" + dni_docente;

    const cardColors = ["bg-primary", "bg-success", "bg-info", "bg-warning", "bg-danger"];

    function createCursoCard(curso) {
      const colorClass = cardColors[Math.floor(Math.random() * cardColors.length)];
      const evaluaciones = curso.evaluaciones.length ? curso.evaluaciones.map(createEvaluacionItem).join('') : '<p class="text-muted">No hay evaluaciones para este curso.</p>';
      
      return `
        <div class="col-md-6 col-lg-4">
          <div class="card curso-card shadow-sm">
            <div class="card-header ${colorClass} text-white">
              <h5 class="card-title mb-0">${curso.curso.nombre}</h5>
              <small>ID Curso: ${curso.curso.id_curso}</small>
            </div>
            <div class="card-body">
              <h6>Evaluaciones:</h6>
              <div class="evaluaciones-list">${evaluaciones}</div>
            </div>
          </div>
        </div>`;
    }

    function createEvaluacionItem(evaluacion) {
      return `
        <div class="evaluacion-item">
          <strong>${evaluacion.nombre}</strong><br>
          <small>${evaluacion.descripcion}</small><br>
          <button class="btn btn-sm btn-primary mt-2">Realizar Revisi√≥n</button>
        </div>`;
    }

    fetch(url)
      .then(response => response.json())
      .then(data => {
        if (data.cursos && data.cursos.length > 0) {
          evaluacionesList.innerHTML = data.cursos.map(createCursoCard).join('');
        } else {
          evaluacionesList.innerHTML = '<div class="col-12"><p class="text-center">No hay cursos asociados a este docente.</p></div>';
        }
      })
      .catch(error => {
        console.error('Error al obtener las evaluaciones:', error);
        evaluacionesList.innerHTML = '<div class="col-12"><p class="text-center text-danger">Error al cargar las evaluaciones.</p></div>';
      });
  </script>
{% endblock javascripts %}
